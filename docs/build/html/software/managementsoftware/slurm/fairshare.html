

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fairshare &mdash; apolo-docs 0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/css/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/sidebar.css" type="text/css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Getting information about jobs" href="info-jobs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

  
    <a href="../../../index.html" class="icon icon-home"> apolo-docs
  

  
    </a>

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../supercomputers/index.html">Supercomputers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Software</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/index.html">Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../programminglanguages/index.html">Programming Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../applications/index.html">Scientific Applications</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Management Software</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#lmod">Lmod</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#slurm">SLURM</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">SLURM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#tools">Tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../monitoring/index.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operatingsystems/index.html">Operating Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scientific_libraries/index.html">Scientific Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accelerators/index.html">Accelerators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to-acknowledge.html">How to Acknowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../report-a-bug.html">Report a Bug</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">apolo-docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Software</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Management Software</a></li>
          <li class="breadcrumb-item"><a href="index.html">SLURM</a></li>
      <li class="breadcrumb-item active"><strong>Fairshare</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/software/managementsoftware/slurm/fairshare.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fairshare">
<span id="fairhsare-slurm"></span><h1><strong>Fairshare</strong><a class="headerlink" href="#fairshare" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tested" id="id1">Tested</a></p></li>
<li><p><a class="reference internal" href="#fair-share-factor" id="id2">Fair-share Factor</a></p></li>
<li><p><a class="reference internal" href="#regenerate-the-initram-on-centos-8" id="id3">Regenerate the initram on CentOS 8</a></p></li>
<li><p><a class="reference internal" href="#plugins" id="id4">Plugins</a></p>
<ul>
<li><p><a class="reference internal" href="#multifactor-priority-plugin" id="id5">Multifactor Priority Plugin</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#slurm-conf" id="id6">Slurm.conf</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-configure-slurm-fair-shares" id="id7">¿How do I configure Slurm Fair Shares?</a></p></li>
<li><p><a class="reference internal" href="#more-information" id="id8">More information</a></p></li>
<li><p><a class="reference internal" href="#authors" id="id9">Authors</a></p></li>
</ul>
</nav>
<section id="tested">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Tested</a><a class="headerlink" href="#tested" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Installation date:</strong> 30/04/2021</p></li>
<li><p><strong>Apolo version:</strong> Apolo Test Environment</p></li>
</ul>
</section>
<section id="fair-share-factor">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Fair-share Factor</a><a class="headerlink" href="#fair-share-factor" title="Link to this heading"></a></h2>
<p>The fair-share is a penalty policy not implemented in slurm by default, its component to a job’s priority influences the order in which a user’s queued jobs are scheduled to run based on the portion of the computing resources they have been allocated and the resources their jobs have already consumed. The fair-share factor does not involve a fixed allotment, whereby a user’s access to a machine is cut off once that allotment is reached.</p>
<p>Instead, the fair-share factor serves to prioritize queued jobs such that those jobs charging accounts that are under-serviced are scheduled first, while jobs charging accounts that are over-serviced are scheduled when the machine would otherwise go idle.</p>
<p>Slurm’s fair-share factor is a floating point number between 0.0 and 1.0 that reflects the shares of a computing resource that a user has been allocated and the amount of computing resources the user’s jobs have consumed. The higher the value, the higher is the placement in the queue of jobs waiting to be scheduled.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Computing the fair-share factor requires the installation and operation of the Slurm Accounting Database to provide the assigned shares and the consumed, computing resources described below.</p>
</div>
</section>
<section id="regenerate-the-initram-on-centos-8">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Regenerate the initram on CentOS 8</a><a class="headerlink" href="#regenerate-the-initram-on-centos-8" title="Link to this heading"></a></h2>
<p>In CenOS 8 you need to use the <code class="docutils literal notranslate"><span class="pre">dracut</span></code> tool to manage the initram. In order to regenerate and install the <code class="docutils literal notranslate"><span class="pre">initram</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dracut<span class="w"> </span>--force<span class="w"> </span><span class="c1"># This will force the generation and installation when an initram already exists</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Apolo is currently supported by CentOS 6.6, which makes it impossible to use initram.</p>
</div>
</section>
<section id="plugins">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Plugins</a><a class="headerlink" href="#plugins" title="Link to this heading"></a></h2>
<section id="multifactor-priority-plugin">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Multifactor Priority Plugin</a><a class="headerlink" href="#multifactor-priority-plugin" title="Link to this heading"></a></h3>
<p>The Multi-factor Job Priority plugin provides a very versatile facility for ordering the queue of jobs waiting to be scheduled.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The multi-factor priority plugin is already installed in the Apolo cluster.</p>
</div>
</section>
</section>
<section id="slurm-conf">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Slurm.conf</a><a class="headerlink" href="#slurm-conf" title="Link to this heading"></a></h2>
<p>The slurm.conf file describes general Slurm configuration information. Here we may put the plugins we want to use to manage our cluster resources. In our case we are going to use the <code class="docutils literal notranslate"><span class="pre">PriorityWeightFairshare=2000</span></code> in the section <code class="docutils literal notranslate"><span class="pre">PriorityType=priority/multifactor</span></code>. Equal to 2000 since in the previous configuration of other factors such as <code class="docutils literal notranslate"><span class="pre">PriorityWeightPartition</span></code> is equal to 2000, in general all factors should be equal to the same amount.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fairshare is only supported on CentOS 7 onwards.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>slurmdbd must be restarted when making changes to slurm.conf.</p>
</div>
</section>
<section id="how-do-i-configure-slurm-fair-shares">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">¿How do I configure Slurm Fair Shares?</a><a class="headerlink" href="#how-do-i-configure-slurm-fair-shares" title="Link to this heading"></a></h2>
<p>Slurm Fair Sharing can be configured using the sacctmgr tool. The following example illustrates how 50% Fair Sharing between two Users, User1 and User2, can be configured.</p>
<ol class="arabic">
<li><dl>
<dt>The Fairshare of the parent account must be modified.</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacctmgr<span class="w"> </span>modify<span class="w"> </span>where<span class="w"> </span><span class="nv">account</span><span class="o">=</span>science<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">fairshare</span><span class="o">=</span><span class="m">50</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>The Fairshare of the account must be modified.</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacctmgr<span class="w"> </span>modify<span class="w"> </span>where<span class="w"> </span><span class="nv">account</span><span class="o">=</span>chemistry<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">fairshare</span><span class="o">=</span><span class="m">30</span>

sacctmgr<span class="w"> </span>modify<span class="w"> </span>where<span class="w"> </span><span class="nv">account</span><span class="o">=</span>physics<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">fairshare</span><span class="o">=</span><span class="m">20</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>Enroll two users into the physics accounts with 0.5 of the resources assigned to each user:</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacctmgr<span class="w"> </span>modify<span class="w"> </span>where<span class="w"> </span>user<span class="w"> </span><span class="nv">name</span><span class="o">=</span>User1<span class="w"> </span><span class="nv">cluster</span><span class="o">=</span>apolito<span class="w"> </span><span class="nv">account</span><span class="o">=</span>physics<span class="w"> </span><span class="nv">fairshare</span><span class="o">=</span><span class="m">10</span>

sacctmgr<span class="w"> </span>modify<span class="w"> </span>where<span class="w"> </span>user<span class="w"> </span><span class="nv">name</span><span class="o">=</span>User2<span class="w"> </span><span class="nv">cluster</span><span class="o">=</span>apolito<span class="w"> </span><span class="nv">account</span><span class="o">=</span>physics<span class="w"> </span><span class="nv">fairshare</span><span class="o">=</span><span class="m">10</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>The fair share configurations can be reviewed for a particular cluster as follows:</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sacctmgr<span class="w"> </span>list<span class="w"> </span>associations<span class="w"> </span><span class="nv">cluster</span><span class="o">=</span>apolito<span class="w"> </span><span class="nv">format</span><span class="o">=</span>Account,Cluster,User,Fairshare
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case the fairshare has been configured with small values, since it has been tested in Apolo test environment, which has few resources and is used for testing before moving to production, also has the CentOS 8 operating system.</p>
</div>
</section>
<section id="more-information">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">More information</a><a class="headerlink" href="#more-information" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://slurm.schedmd.com/quickstart.html">Quick Start User Guide</a>.</p></li>
<li><p><a class="reference external" href="https://support.ceci-hpc.be/doc/_contents/QuickStart/SubmittingJobs/SlurmTutorial.html">Slurm + tutorial - Software and Environment Module</a></p></li>
<li><p><a class="reference external" href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.10.6834">SLURM: Simple Linux Utility for Resource Management</a>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="authors">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Authors</a><a class="headerlink" href="#authors" title="Link to this heading"></a></h2>
<p>Bryan López Parra &lt;<a class="reference external" href="mailto:blopezp&#37;&#52;&#48;eafit&#46;edu&#46;co">blopezp<span>&#64;</span>eafit<span>&#46;</span>edu<span>&#46;</span>co</a>&gt;</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="info-jobs.html" class="btn btn-neutral float-left" title="Getting information about jobs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Creative Commons Attribution-NonCommercial 4.0 International License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>